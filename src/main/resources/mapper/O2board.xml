<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kosta.o2dao.O2WriteDAO">
     <parameterMap type="java.util.HashMap" id="hashmap"/>	
 
	<insert id="twriteinsert"
		parameterType="com.kosta.o2dto.O2WriteBoardDTO">
		insert into TradeBoard_3jo(user_id,title,content
		,category,writedate
		,map_x,map_y
		,tradeaddr,sell_price,deal_price)
		
		values('test',#{title},#{content},#{category},sysdate()
		,#{map_x},#{map_y}
		,'서울 구로구',#{sell_price},#{deal_price})
		
		<selectKey keyProperty="tradeno" resultType="int" order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>
	
	<select id="twritedetail" parameterType="int" resultType="com.kosta.o2dto.O2WriteBoardDTO">
		select title
		,tradeno
		,category
		,map_x,map_y
		,content
		,sell_price
		,deal_price
		from TradeBoard_3jo
		where tradeno=#{no}
	</select>
	
	<delete id="twritedelete" parameterType="int">
		delete from TradeBoard_3jo
		where tradeno=#{no}
	</delete>
	
	<update id="twritemodifyresult" parameterType="com.kosta.o2dto.O2WriteBoardDTO">
		update TradeBoard_3jo
			set category=#{category}
				,title=#{title}
				,content=#{content}
				,map_x=#{map_x}
				,map_y=#{map_y}
		where tradeno=#{tradeno}
	</update>
	
	<insert id="tinsertfile" parameterType="com.kosta.o2dto.O2FileDTO">
		insert into File_3jo(temp_name,real_name,tradeno)
		values (#{temp_name},#{real_name},#{tradeno})
	</insert>
	
	<select id="tfiledetail" parameterType="int" resultType="com.kosta.o2dto.O2FileDTO">
		select real_name
		from File_3jo
		where tradeno=#{no}
	</select>
	
	<delete id="tfiledelete" parameterType="int">
		delete from File_3jo
		where tradeno=#{no}
	</delete>
	
	<select id="getqlist" resultType="com.kosta.o2dto.O2QnaBoardDTO">
		select qnano
		,title
		,user_id
		,writedate
		from QABoard_3jo
	</select>


	<select id="totalCount" parameterType="hashmap" resultType="int">
		select count(*) from TradeBoard_3jo
		<where>
			<if
				test="searchtxt=null and searchtxt!='' and !searchtext.equals('')">
				<choose>
					<when test="search=='user_id'">
						and user_id=#{searchtxt}
					</when>
					<when test="search=='content'">
						and content=#{searchtxt}
					</when>
					<when test="search=='title'">
						and title=#{searchtxt}
					</when>
				</choose>
			</if>
		</where>
	</select>


	<select id="list" parameterType="hashmap"
		resultType="com.kosta.o2dto.O2MainBoardDTO">
		select * from (
		select rownum, b.*
		from( select user_id, content, title
		from TradeBoard_3jo
		<where>
			<if test="searchtxt!=null and searchtxt!=''">
				<choose>
					<when test="search=='user_id'">
						and user_id = #{searchtxt}
					</when>
					<when test="search=='content'">
						and content = #{searchtxt}
					</when>
					<when test="search=='title'">
						and title = #{searchtxt}
					</when>
				</choose>
			</if>
		</where>
 		<![CDATA[
 			order by tradeno
 			) e
 		]]>
		<where>
 		<![CDATA[
 		    rownum<=#{endRow}
 		]]>
		</where>
		)
		<where>
 		<![CDATA[
 			rnum>=#{startRow}
 		]]>
		</where>
	</select>

	<select id="topviewlist"
		resultType="com.kosta.o2dto.O2WriteBoardDTO">
		select title
		,tradeno
		,user_id
		,writedate
		,viewno
		,likeno
		from TradeBoard_3jo
		order by viewno desc limit 10
	</select>
	
	<select id="selllist" resultType="com.kosta.o2dto.O2WriteBoardDTO">
		select title
		,tradeno
		,user_id
		,writedate
		,viewno
		,likeno
		from TradeBoard_3jo
	</select>
	
	<select id="deallist" resultType="com.kosta.o2dto.O2WriteBoardDTO">
	<![CDATA[
		select title
		,tradeno
		,user_id
		,writedate
		,viewno
		,likeno
		,deal_price
		from TradeBoard_3jo
		where deal_price REGEXP '^[0-9]+$'
	]]>
	</select>
	
	<select id="getdonglist" resultType="com.kosta.o2dto.O2DongComDTO">
	  select chatno
	         ,title
	         ,user_id
	         ,writedate
	         ,viewno
	         ,likeno
	         from ChatBoard_3jo
	</select>
	
	<insert id="dwriteinsert"
		parameterType="com.kosta.o2dto.O2DongComDTO">
		insert into ChatBoard_3jo(user_id,title,content
		,category,writedate
		,map_x,map_y)
		
		values('test',#{title},#{content},#{category},sysdate()
		,#{map_x},#{map_y})
		
		<selectKey keyProperty="chatno" resultType="int" order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>
	
	<select id="dwritedetail" parameterType="int" resultType="com.kosta.o2dto.O2DongComDTO">
		select title
		,chatno
		,category
		,map_x,map_y
		,content
		from ChatBoard_3jo
		where chatno=#{no}
	</select>
	
	<delete id="dwritedelete" parameterType="int">
		delete from ChatBoard_3jo
		where chatno=#{no}
	</delete>
	
	<update id="dwritemodifyresult" parameterType="com.kosta.o2dto.O2DongComDTO">
		update ChatBoard_3jo
			set category=#{category}
				,title=#{title}
				,content=#{content}
				,map_x=#{map_x}
				,map_y=#{map_y}
		where chatno=#{chatno}
	</update>
	
	<insert id="dinsertfile" parameterType="com.kosta.o2dto.O2FileDTO">
		insert into File_3jo(temp_name,real_name,chatno)
		values (#{temp_name},#{real_name},#{chatno})
	</insert>
	
	<select id="dfiledetail" parameterType="int" resultType="com.kosta.o2dto.O2FileDTO">
		select real_name
		from File_3jo
		where chatno=#{no}
	</select>
	
	<delete id="dfiledelete" parameterType="int">
		delete from File_3jo
		where chatno=#{no}
	</delete>
	
	<insert id="qwriteinsert"
		parameterType="com.kosta.o2dto.O2QnaBoardDTO">
		insert into QABoard_3jo(user_id,title,content
		,category,writedate)
		
		values('test',#{title},#{content},#{category},sysdate())
		
		<selectKey keyProperty="qnano" resultType="int" order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>
	
	<select id="qwritedetail" parameterType="int" resultType="com.kosta.o2dto.O2QnaBoardDTO">
		select title
		,qnano
		,category
		,content
		from QABoard_3jo
		where qnano=#{no}
	</select>
	
	<delete id="qwritedelete" parameterType="int">
		delete from QABoard_3jo
		where qnano=#{no}
	</delete>
	
	<update id="qwritemodifyresult" parameterType="com.kosta.o2dto.O2QnaBoardDTO">
		update QABoard_3jo
			set category=#{category}
				,title=#{title}
				,content=#{content}
		where qnano=#{qnano}
	</update>
	
	<insert id="qinsertfile" parameterType="com.kosta.o2dto.O2FileDTO">
		insert into File_3jo(temp_name,real_name,qnano)
		values (#{temp_name},#{real_name},#{qnano})
	</insert>
	
	<select id="qfiledetail" parameterType="int" resultType="com.kosta.o2dto.O2FileDTO">
		select real_name
		from File_3jo
		where qnano=#{no}
	</select>
	
	<delete id="qfiledelete" parameterType="int">
		delete from File_3jo
		where qnano=#{no}
	</delete>
	
	
</mapper>